<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BL7 (Tax) - Mock Paper 02</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c 0%, #b21f1f 50%, #fdbb2d 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
        }
        
        /* Title Bar */
        .title-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #1a2a6c;
            color: white;
        }
        
        .title-bar h1 {
            font-size: 1.5rem;
            margin: 0;
        }
        
        .title-buttons {
            display: flex;
            gap: 10px;
        }
        
        .title-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: #fdbb2d;
            color: black;
        }
        
        .title-btn:hover {
            background: #ffc93b;
        }
        
        /* Start Page */
        .start-page {
            padding: 40px;
        }
        
        .exam-title {
            font-size: 2.5rem;
            color: #1a2a6c;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .setup-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .setup-title {
            color: #b21f1f;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .setup-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }
        
        .setup-option {
            flex: 1;
        }
        
        .setup-option label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a2a6c;
        }
        
        .time-inputs {
            display: flex;
            gap: 10px;
        }
        
        .time-input {
            display: flex;
            flex-direction: column;
        }
        
        .time-input input {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            width: 80px;
            font-size: 1rem;
        }
        
        .time-input span {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 5px;
        }
        
        select {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            width: 100%;
            font-size: 1rem;
        }
        
        .resource-status {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .resource-status:hover {
            background: #dee2e6;
        }
        
        .resource-link {
            color: #1a2a6c;
            text-decoration: none;
            font-weight: 600;
        }
        
        .resource-link:hover {
            text-decoration: underline;
        }
        
        .status-available {
            color: #28a745;
            font-weight: 600;
        }
        
        .status-not-available {
            color: #dc3545;
            font-weight: 600;
        }
        
        .start-btn {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Exam Page */
        .exam-page {
            display: none;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px 0;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #b21f1f;
            background: #fff4f4;
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .question-number {
            font-size: 1.3rem;
            color: #333;
        }
        
        .question-container {
            text-align: center;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        
        .question-image {
            max-width: 100%;
            max-height: 400px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .image-placeholder {
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #6c757d;
            font-size: 1.1rem;
            flex-direction: column;
            gap: 15px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .left-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .right-controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-btn {
            background: #1a2a6c;
            color: white;
        }
        
        .nav-btn:hover {
            background: #24388b;
        }
        
        .action-btn {
            background: #b21f1f;
            color: white;
        }
        
        .action-btn:hover {
            background: #c82323;
        }
        
        .note-btn {
            background: #fdbb2d;
            color: black;
        }
        
        .note-btn:hover {
            background: #ffc93b;
        }
        
        .note-btn:disabled {
            background: #6c757d;
            color: white;
            cursor: not-allowed;
        }
        
        .restart-btn {
            background: #6c757d;
            color: white;
        }
        
        .restart-btn:hover {
            background: #5a6268;
        }
        
        .mark-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #1a2a6c;
            font-weight: 600;
        }
        
        .progress-container {
            padding: 0 20px;
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .progress-text {
            font-size: 1.1rem;
            color: #495057;
            font-weight: 600;
            text-align: center;
        }
        
        .questions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 8px;
            margin: 20px 0;
            padding: 0 20px;
        }
        
        .question-box {
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #e9ecef;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }
        
        .question-box:hover {
            background: #dee2e6;
        }
        
        .question-box.current {
            border-color: #1a2a6c;
        }
        
        .question-box .number {
            font-size: 1.1rem;
            z-index: 2;
        }
        
        .question-box .status {
            font-size: 0.6rem;
            margin-top: 3px;
            text-align: center;
            z-index: 2;
            padding: 0 2px;
        }
        
        .question-box.answered {
            background: #d4edda;
        }
        
        .question-box.marked {
            background: #d4edda;
        }
        
        .question-box.noted::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            border-left: 12px solid transparent;
            border-top: 12px solid #fdbb2d;
        }
        
        hr {
            border: none;
            height: 1px;
            background: #dee2e6;
            margin: 20px 0;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .note-image {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            color: #888;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #1a2a6c;
            color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1001;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .questions-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .left-controls, .right-controls {
                width: 100%;
                justify-content: center;
            }
            
            .exam-title {
                font-size: 2rem;
            }
            
            .time-inputs {
                flex-wrap: wrap;
            }
            
            .setup-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .title-bar {
                flex-direction: column;
                gap: 10px;
            }
            
            .title-buttons {
                width: 100%;
                justify-content: center;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .timer.warning {
            animation: pulse 1s infinite;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Title Bar -->
        <div class="title-bar">
            <h1>BL7 (Tax) - Mock Paper 02</h1>
            <div class="title-buttons">
                <button class="title-btn" id="homeBtn"><i class="fas fa-home"></i> Home</button>
                <button class="title-btn" id="restartBtn"><i class="fas fa-redo"></i> Restart</button>
                <button class="title-btn" id="resetBtn"><i class="fas fa-undo"></i> Reset</button>
            </div>
        </div>
        
        <!-- Start Page -->
        <div class="start-page" id="startPage">
            <h1 class="exam-title">BL7 (Tax) - Mock Paper 02</h1>
            
            <div class="setup-container">
                <h2 class="setup-title">Exam Setup</h2>
                
                <div class="setup-row">
                    <div class="setup-option">
                        <label for="timerHours">Exam Timer:</label>
                        <div class="time-inputs">
                            <div class="time-input">
                                <input type="number" id="timerHours" min="0" max="23" value="0">
                                <span>Hours</span>
                            </div>
                            <div class="time-input">
                                <input type="number" id="timerMinutes" min="0" max="59" value="30">
                                <span>Minutes</span>
                            </div>
                            <div class="time-input">
                                <input type="number" id="timerSeconds" min="0" max="59" value="0">
                                <span>Seconds</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setup-option">
                        <label for="questionOrder">Question Order:</label>
                        <select id="questionOrder">
                            <option value="sequential">Sequential (Not Shuffled)</option>
                            <option value="shuffled">Shuffled</option>
                        </select>
                    </div>
                </div>
                
                <hr>
                
                <h3>Resources Status:</h3>
                <div class="resource-status">
                    <a href="https://github.com/Homoro-cc/Exam-1-test/tree/main/Questions" class="resource-link" target="_blank">Questions</a>
                    <span id="questionsStatus" class="status-available">Checking...</span>
                </div>
                <div class="resource-status">
                    <a href="https://github.com/Homoro-cc/Exam-1-test/tree/main/Notes" class="resource-link" target="_blank">Notes</a>
                    <span id="notesStatus" class="status-available">Checking...</span>
                </div>
                <div class="resource-status">
                    <a href="https://github.com/Homoro-cc/Exam-1-test/blob/main/answer.txt" class="resource-link" target="_blank">Answers</a>
                    <span id="answersStatus" class="status-available">Checking...</span>
                </div>
            </div>
            
            <button class="start-btn" id="startBtn">
                Start Exam <i class="fas fa-arrow-right"></i>
            </button>
        </div>
        
        <!-- Exam Page -->
        <div class="exam-page" id="examPage">
            <div class="header">
                <div class="timer" id="timer">00:30:00</div>
                <div class="question-number" id="questionNumber">Question 1 of 10</div>
            </div>
            
            <div class="question-container">
                <div id="imageContainer">
                    <!-- Image will be loaded here -->
                </div>
            </div>
            
            <div class="status-bar">
                <div class="left-controls">
                    <button class="btn action-btn" id="answerBtn"><i class="fas fa-lightbulb"></i> Answer</button>
                    <button class="btn note-btn" id="noteBtn"><i class="fas fa-sticky-note"></i> Note</button>
                    <div class="mark-status" id="markStatus">
                        <input type="checkbox" id="markQuestion">
                        <label for="markQuestion">Answer is Marked</label>
                    </div>
                </div>
                
                <div class="right-controls">
                    <button class="btn nav-btn" id="prevBtn"><i class="fas fa-arrow-left"></i> Previous</button>
                    <button class="btn nav-btn" id="nextBtn">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Progress: 0/10 (0%)</div>
            </div>
            
            <div class="questions-grid" id="questionsGrid">
                <!-- Question boxes will be generated here -->
            </div>
        </div>
    </div>
    
    <!-- Note Modal -->
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <span class="close-btn" id="closeNoteBtn">&times;</span>
            <h2>Additional Note</h2>
            <div id="noteContent">
                <!-- Note content will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Answer Notification -->
    <div class="notification" id="answerNotification">
        The correct answer is: <strong id="correctAnswer"></strong>
    </div>

    <script>
        // DOM Elements
        const startPage = document.getElementById('startPage');
        const examPage = document.getElementById('examPage');
        const startBtn = document.getElementById('startBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const answerBtn = document.getElementById('answerBtn');
        const noteBtn = document.getElementById('noteBtn');
        const homeBtn = document.getElementById('homeBtn');
        const restartBtn = document.getElementById('restartBtn');
        const resetBtn = document.getElementById('resetBtn');
        const timer = document.getElementById('timer');
        const questionNumber = document.getElementById('questionNumber');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const answerNotification = document.getElementById('answerNotification');
        const correctAnswer = document.getElementById('correctAnswer');
        const imageContainer = document.getElementById('imageContainer');
        const questionsGrid = document.getElementById('questionsGrid');
        const markQuestion = document.getElementById('markQuestion');
        const markStatus = document.getElementById('markStatus');
        const timerHours = document.getElementById('timerHours');
        const timerMinutes = document.getElementById('timerMinutes');
        const timerSeconds = document.getElementById('timerSeconds');
        const questionOrder = document.getElementById('questionOrder');
        const questionsStatus = document.getElementById('questionsStatus');
        const notesStatus = document.getElementById('notesStatus');
        const answersStatus = document.getElementById('answersStatus');
        const noteModal = document.getElementById('noteModal');
        const closeNoteBtn = document.getElementById('closeNoteBtn');
        const noteContent = document.getElementById('noteContent');
        
        // Exam state
        let currentQuestion = 1;
        let totalQuestions = 0; // Will be determined dynamically
        let examTime = 0;
        let timerInterval;
        let questionOrderArray = [];
        let markedQuestions = new Set();
        let answeredQuestions = new Set();
        let notedQuestions = new Set();
        let originalQuestionOrder = [];
        let answerData = {};
        let noteAvailability = {};
        
        // GitHub repository information
        const githubUsername = "Homoro-cc";
        const githubRepo = "Exam-1-test";
        const baseUrl = `https://${githubUsername}.github.io/${githubRepo}`;
        
        // Initialize the page
        function initPage() {
            // Check resource availability
            checkResources();
            
            // Load answer data
            loadAnswerData();
            
            // Set up event listeners
            startBtn.addEventListener('click', startExam);
            prevBtn.addEventListener('click', goToPrevQuestion);
            nextBtn.addEventListener('click', goToNextQuestion);
            answerBtn.addEventListener('click', showAnswer);
            noteBtn.addEventListener('click', showNote);
            homeBtn.addEventListener('click', goHome);
            restartBtn.addEventListener('click', restartExam);
            resetBtn.addEventListener('click', resetExam);
            markQuestion.addEventListener('change', toggleMarkQuestion);
            closeNoteBtn.addEventListener('click', closeNoteModal);
            
            // Close modal if clicked outside
            window.addEventListener('click', (e) => {
                if (e.target === noteModal) {
                    closeNoteModal();
                }
            });
        }
        
        // Load answer data from answer.txt
        function loadAnswerData() {
            const answerUrl = `${baseUrl}/answer.txt`;
            
            fetch(answerUrl)
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('Answer file not found');
                })
                .then(text => {
                    // Parse answer data
                    const lines = text.split('\n');
                    lines.forEach(line => {
                        const match = line.match(/(\d+)\s*[=:]\s*(\d+)/);
                        if (match) {
                            const questionNum = parseInt(match[1]);
                            const answer = match[2];
                            answerData[questionNum] = answer;
                        }
                    });
                    
                    // Count total questions based on answer data
                    totalQuestions = Object.keys(answerData).length;
                    
                    // Create original question order
                    originalQuestionOrder = Array.from({length: totalQuestions}, (_, i) => i + 1);
                    
                    answersStatus.textContent = 'Available';
                    answersStatus.className = 'status-available';
                })
                .catch(() => {
                    answersStatus.textContent = 'Not available';
                    answersStatus.className = 'status-not-available';
                });
        }
        
        // Check note availability for all questions
        function checkNoteAvailability() {
            // Check notes for all questions
            for (let i = 1; i <= totalQuestions; i++) {
                checkNoteForQuestion(i);
            }
        }
        
        // Check if note exists for a specific question
        function checkNoteForQuestion(questionNum) {
            const noteTextUrl = `${baseUrl}/Notes/${questionNum}.txt`;
            const noteImageUrl = `${baseUrl}/Notes/${questionNum}.png`;
            
            // First check for text note
            fetch(noteTextUrl, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        noteAvailability[questionNum] = true;
                        return;
                    }
                    
                    // If text note not found, check for image note
                    fetch(noteImageUrl, { method: 'HEAD' })
                        .then(response => {
                            noteAvailability[questionNum] = response.ok;
                        })
                        .catch(() => {
                            noteAvailability[questionNum] = false;
                        });
                })
                .catch(() => {
                    noteAvailability[questionNum] = false;
                });
        }
        
        // Check resource availability
        function checkResources() {
            // Check questions - we'll check for the first question to determine availability
            checkResource(`${baseUrl}/Questions/1.png`, questionsStatus);
            
            // Check notes - we'll check for the first note to determine availability
            checkResource(`${baseUrl}/Notes/1.txt`, notesStatus, true);
        }
        
        // Check if a resource is available
        function checkResource(url, statusElement, checkImage = false) {
            fetch(url, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        statusElement.textContent = 'Available';
                        statusElement.className = 'status-available';
                        return;
                    }
                    
                    // If checking notes and text not found, try image format
                    if (checkImage) {
                        const imageUrl = url.replace('.txt', '.png');
                        fetch(imageUrl, { method: 'HEAD' })
                            .then(response => {
                                statusElement.textContent = response.ok ? 'Available' : 'Not available';
                                statusElement.className = response.ok ? 'status-available' : 'status-not-available';
                            })
                            .catch(() => {
                                statusElement.textContent = 'Not available';
                                statusElement.className = 'status-not-available';
                            });
                    } else {
                        throw new Error('Resource not found');
                    }
                })
                .catch(() => {
                    statusElement.textContent = 'Not available';
                    statusElement.className = 'status-not-available';
                });
        }
        
        // Start exam
        function startExam() {
            // Calculate exam time in seconds
            const hours = parseInt(timerHours.value) || 0;
            const minutes = parseInt(timerMinutes.value) || 0;
            const seconds = parseInt(timerSeconds.value) || 0;
            
            examTime = hours * 3600 + minutes * 60 + seconds;
            
            if (examTime <= 0) {
                alert('Please set a valid exam time.');
                return;
            }
            
            // Initialize the exam
            initExam();
            
            // Switch to exam page
            startPage.style.display = 'none';
            examPage.style.display = 'block';
        }
        
        // Initialize the exam
        function initExam() {
            // Create question order based on selection
            questionOrderArray = [...originalQuestionOrder];
            if (questionOrder.value === 'shuffled') {
                shuffleArray(questionOrderArray);
            }
            
            // Check note availability for all questions
            checkNoteAvailability();
            
            // Reset tracking sets
            markedQuestions.clear();
            answeredQuestions.clear();
            notedQuestions.clear();
            
            // Generate question boxes
            generateQuestionBoxes();
            
            // Start timer
            startTimer();
            
            // Load first question
            updateQuestion();
        }
        
        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Generate question boxes
        function generateQuestionBoxes() {
            questionsGrid.innerHTML = '';
            
            // Adjust grid layout based on number of questions
            const gridColumns = totalQuestions > 10 ? 15 : 10;
            questionsGrid.style.gridTemplateColumns = `repeat(${gridColumns}, 1fr)`;
            
            for (let i = 1; i <= totalQuestions; i++) {
                const box = document.createElement('div');
                box.className = 'question-box';
                box.innerHTML = `
                    <div class="number">${i}</div>
                    <div class="status"></div>
                `;
                box.addEventListener('click', () => {
                    currentQuestion = i;
                    updateQuestion();
                });
                questionsGrid.appendChild(box);
            }
        }
        
        // Update question boxes appearance
        function updateQuestionBoxes() {
            const boxes = questionsGrid.querySelectorAll('.question-box');
            boxes.forEach((box, index) => {
                const questionNum = index + 1;
                
                // Reset classes
                box.className = 'question-box';
                
                // Add appropriate classes
                if (questionNum === currentQuestion) {
                    box.classList.add('current');
                }
                if (answeredQuestions.has(questionNum)) {
                    box.classList.add('answered');
                }
                if (markedQuestions.has(questionNum)) {
                    box.classList.add('marked');
                }
                if (noteAvailability[questionNum] && notedQuestions.has(questionNum)) {
                    box.classList.add('noted');
                }
                
                // Update status text
                const statusEl = box.querySelector('.status');
                statusEl.textContent = '';
                
                if (answeredQuestions.has(questionNum)) {
                    statusEl.textContent = 'Answered';
                }
                
                if (notedQuestions.has(questionNum)) {
                    if (statusEl.textContent) statusEl.textContent += ', ';
                    statusEl.textContent += 'Noted';
                }
            });
            
            // Update progress bar based on marked questions
            updateProgressBar();
            
            // Update note button state
            updateNoteButton();
        }
        
        // Update note button based on availability
        function updateNoteButton() {
            // Get the actual question number (considering shuffling)
            const actualQuestionNum = questionOrder.value === 'shuffled' ? 
                questionOrderArray[currentQuestion - 1] : currentQuestion;
                
            if (noteAvailability[actualQuestionNum]) {
                noteBtn.disabled = false;
                noteBtn.title = "View note for this question";
            } else {
                noteBtn.disabled = true;
                noteBtn.title = "No note available for this question";
            }
        }
        
        // Update progress bar based on marked questions
        function updateProgressBar() {
            const progressPercent = Math.round((markedQuestions.size / totalQuestions) * 100);
            progressText.textContent = `Progress: ${markedQuestions.size}/${totalQuestions} (${progressPercent}%)`;
            progressFill.style.width = `${progressPercent}%`;
        }
        
        // Navigation functions
        function goToPrevQuestion() {
            if (currentQuestion > 1) {
                currentQuestion--;
                updateQuestion();
            }
        }
        
        function goToNextQuestion() {
            if (currentQuestion < totalQuestions) {
                currentQuestion++;
                updateQuestion();
            }
        }
        
        // Show answer
        function showAnswer() {
            // Get the actual question number (considering shuffling)
            const actualQuestionNum = questionOrder.value === 'shuffled' ? 
                questionOrderArray[currentQuestion - 1] : currentQuestion;
                
            // Get answer from answer data
            const answer = answerData[actualQuestionNum] || 'Not available';
            
            correctAnswer.textContent = answer;
            
            // Mark as answered
            answeredQuestions.add(currentQuestion);
            updateQuestionBoxes();
            
            answerNotification.style.display = 'block';
            setTimeout(() => {
                answerNotification.style.display = 'none';
            }, 3000);
        }
        
        // Show note
        function showNote() {
            // Get the actual question number (considering shuffling)
            const actualQuestionNum = questionOrder.value === 'shuffled' ? 
                questionOrderArray[currentQuestion - 1] : currentQuestion;
                
            // Try to load note as text first
            const noteTextUrl = `${baseUrl}/Notes/${actualQuestionNum}.txt`;
            const noteImageUrl = `${baseUrl}/Notes/${actualQuestionNum}.png`;
            
            noteContent.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Loading note...</p>';
            noteModal.style.display = 'flex';
            
            fetch(noteTextUrl)
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('Text note not found');
                })
                .then(text => {
                    noteContent.innerHTML = `
                        <p><strong>Note for Question ${actualQuestionNum}:</strong></p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                            <pre style="white-space: pre-wrap; font-family: inherit;">${text}</pre>
                        </div>
                    `;
                    
                    // Mark as noted
                    notedQuestions.add(currentQuestion);
                    updateQuestionBoxes();
                })
                .catch(() => {
                    // If text note not found, try to load as image
                    const img = new Image();
                    img.onload = function() {
                        noteContent.innerHTML = `
                            <p><strong>Note for Question ${actualQuestionNum}:</strong></p>
                            <img src="${noteImageUrl}" alt="Note for Question ${actualQuestionNum}" class="note-image">
                        `;
                        
                        // Mark as noted
                        notedQuestions.add(currentQuestion);
                        updateQuestionBoxes();
                    };
                    
                    img.onerror = function() {
                        noteContent.innerHTML = `
                            <div class="image-placeholder" style="height: auto; padding: 20px;">
                                <i class="fas fa-exclamation-triangle fa-2x" style="color: #ffc107; margin-bottom: 15px;"></i>
                                <p>No note available for this question.</p>
                            </div>
                        `;
                    };
                    
                    img.src = noteImageUrl;
                });
        }
        
        // Close note modal
        function closeNoteModal() {
            noteModal.style.display = 'none';
        }
        
        // Toggle mark question
        function toggleMarkQuestion() {
            if (markQuestion.checked) {
                markedQuestions.add(currentQuestion);
            } else {
                markedQuestions.delete(currentQuestion);
            }
            updateQuestionBoxes();
        }
        
        // Go to home
        function goHome() {
            window.location.href = "https://www.google.com";
        }
        
        // Restart exam
        function restartExam() {
            if (confirm('Are you sure you want to restart the exam? All progress will be lost.')) {
                clearInterval(timerInterval);
                startPage.style.display = 'block';
                examPage.style.display = 'none';
            }
        }
        
        // Reset exam
        function resetExam() {
            if (confirm('Are you sure you want to reset all answers?')) {
                markedQuestions.clear();
                answeredQuestions.clear();
                notedQuestions.clear();
                updateQuestionBoxes();
                updateQuestion();
            }
        }
        
        // Update question display
        function updateQuestion() {
            questionNumber.textContent = `Question ${currentQuestion} of ${totalQuestions}`;
            
            // Load question image from GitHub
            loadQuestionImage();
            
            // Enable/disable navigation buttons
            prevBtn.disabled = currentQuestion === 1;
            nextBtn.disabled = currentQuestion === totalQuestions;
            
            // Update mark status
            markQuestion.checked = markedQuestions.has(currentQuestion);
            
            // Update question boxes
            updateQuestionBoxes();
        }
        
        // Load question image from GitHub
        function loadQuestionImage() {
            // Get the actual question number (considering shuffling)
            const actualQuestionNum = questionOrder.value === 'shuffled' ? 
                questionOrderArray[currentQuestion - 1] : currentQuestion;
                
            // Clear previous content
            imageContainer.innerHTML = `
                <div class="image-placeholder">
                    <div>
                        <i class="fas fa-spinner fa-spin fa-3x" style="margin-bottom: 15px; color: #6c757d;"></i>
                        <p>Loading image from GitHub...</p>
                    </div>
                </div>
            `;
            
            // Try to load image with different naming formats
            const img = new Image();
            
            img.onload = function() {
                imageContainer.innerHTML = '';
                imageContainer.appendChild(img);
            };
            
            img.onerror = function() {
                imageContainer.innerHTML = `
                    <div class="image-placeholder">
                        <div>
                            <i class="fas fa-exclamation-triangle fa-3x" style="margin-bottom: 15px; color: #dc3545;"></i>
                            <p>Image not found for Question ${actualQuestionNum}</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">Tried path: Questions/${actualQuestionNum}.png</p>
                        </div>
                    </div>
                `;
            };
            
            img.src = `${baseUrl}/Questions/${actualQuestionNum}.png`;
            img.alt = `Question ${actualQuestionNum}`;
            img.className = 'question-image';
        }
        
        // Start timer
        function startTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                examTime--;
                updateTimerDisplay();
                
                if (examTime <= 0) {
                    clearInterval(timerInterval);
                    alert('Exam time is over!');
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const hours = Math.floor(examTime / 3600);
            const minutes = Math.floor((examTime % 3600) / 60);
            const seconds = examTime % 60;
            
            timer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (examTime < 300) { // Less than 5 minutes
                timer.classList.add('warning');
            } else {
                timer.classList.remove('warning');
            }
        }
        
        // Initialize the page
        window.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
